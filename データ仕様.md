# データ仕様

本書は最安運賃計算に用いるマスタ/データ構造の仕様を定義する。

## 目的
- 実装とデータ整備の責務分離
- 規則改定時にマスタ差し替えで追従可能にする

## スキーマ
- 駅マスタ (`stations.csv`)
  - `station_id` (string) 必須: 一意な駅ID
  - `name` (string) 必須: 駅名
  - `company` (string) 必須: 会社コード（JR東, JR西 など）
  - `lines` (string[]) 必須: 所属線区IDの配列
  - `zone_flags` (object) 任意: `{ tokutei_zone_id?: string, kinkou_zone_id?: string }`
- 線区マスタ (`lines.csv`)
  - `line_id` (string) 必須
  - `name` (string) 必須
  - `type` (enum) 必須: `mainline` | `local` | `shinkansen`
  - `company` (string) 必須
- 区間マスタ (`segments.csv`)
  - `from_station_id` (string) 必須
  - `to_station_id` (string) 必須
  - `line_id` (string) 必須
  - `distance_km` (number) 必須: 営業キロ（小数可）
- 運賃表 (`fares_main.csv`, `fares_local.csv`)
  - `km` (int) 必須: 1km単位のキロ程
  - `fare` (int) 必須: 円（そのkmに適用される現行/磁気運賃）
- 換算係数 (`conversion.csv`)
  - `line_id` (string) / `company` / `default` のいずれかキーで適用
  - `conv_coeff` (number) 既定 1.1
- 特定都区市内 (`tokutei_zones.csv`)
  - `zone_id` (string) 必須
  - `name` (string) 必須
  - `center_station_id` (string) 必須
  - `member_station_ids` (string[]) 必須
- 大都市近郊区間 (`kinkou_zones.csv`)
  - `zone_id` (string) 必須
  - `name` (string) 必須
  - `member_station_ids` (string[]) 必須

## 列命名・単位
- `eigyou_km`: 営業キロ（km、整数。合算→切上後）
- `kansan_km`: 換算キロ（km、小数許容）
- `calc_km`: 運賃計算キロ（km、整数）

## バリデーション
- 区間は双方向の整合（無向）を保つか、方向付きで双方登録。
- 距離は正数、`to_km >= from_km`。
- ゾーン所属駅IDは全て駅マスタに存在。

## 変更容易性
- 係数・表は環境変数や設定ファイルで差し替え可能とする。

## 運賃表の出典と整備手順
- 詳細は `運賃表.md` を参照。
- CSVテンプレートは `data/fares_main.csv`, `data/fares_local.csv`, `data/fares_tokutei.csv` に配置済み（ヘッダのみ）。

